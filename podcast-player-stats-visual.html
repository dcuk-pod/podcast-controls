<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Statistics</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <style>
        /* CSS styles remain unchanged */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');
        body{background-color:transparent;font-family:'Poppins',sans-serif;color:#333;margin:0;padding:0;overflow:hidden}.stats-wrapper{width:1920px;height:1080px;background-color:#fff;box-sizing:border-box;padding:40px;display:flex;flex-direction:column;position:relative;overflow:hidden;opacity:0;transition:opacity .5s ease-in-out}.stats-wrapper.visible{opacity:1}.background-logos{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:space-between;align-items:center;padding:10%;box-sizing:border-box;z-index:0}.background-logos img{width:35%;opacity:.08}.stats-content{position:relative;z-index:1;display:flex;flex-direction:column;height:100%;overflow:hidden}.top-bar{display:flex;align-items:center;gap:10px;padding-bottom:10px;border-bottom:2px solid #f0f0f0;flex-shrink:0}.league-logo{width:50px;height:50px;object-fit:contain}.fixture-details{display:flex;flex-direction:column;justify-content:center;width:100%}.fixture-name{display:flex;justify-content:center;align-items:center;gap:20px;font-weight:700;font-size:24px}.fixture-meta{font-size:16px;color:#888;margin-top:5px;text-align:center}.tables-area{flex-grow:1;display:grid;grid-template-columns:1fr 1fr;gap:40px;padding-top:10px;opacity:0;transform:translateY(20px);transition:opacity .5s ease,transform .5s ease;overflow:hidden}.tables-area.visible{opacity:1;transform:translateY(0)}.team-table-container{display:flex;flex-direction:column;min-height:0}.team-header{display:flex;align-items:center;gap:10px;margin-bottom:15px;flex-shrink:0}.team-header img{width:40px;height:40px;object-fit:contain}.team-header h3{font-size:22px;font-weight:700;margin:0}.player-table{width:100%;border-collapse:collapse}.player-table td,.player-table th{padding:6px 10px;text-align:left;border-bottom:1px solid #e2e8f0}.player-table thead th{font-size:12px;font-weight:600;color:#4a5568;text-transform:uppercase;background-color:#f7fafc}.player-table tbody tr:last-child td{border-bottom:none}.player-table td{font-size:10px}.text-center{text-align:center}.rating-cell{font-weight:700;border-radius:4px;padding:4px;text-align:center;color:#fff;min-width:30px;display:inline-block}.rating-red{background-color:#e53e3e}.rating-neutral{background-color:#a0aec0;color:#1a202c}.rating-green-light{background-color:#68d391;color:#1a202c}.rating-green-dark{background-color:#38a169}.rating-blue{background-color:#4299e1}.card-yellow{display:inline-block;width:10px;height:14px;background-color:#f6e05e;border:1px solid #a0aec0;border-radius:2px}.card-red{display:inline-block;width:10px;height:14px;background-color:#e53e3e;border:1px solid #718096;border-radius:2px}.team-average-rating{display:flex;justify-content:flex-end;align-items:center;gap:10px;margin-top:auto;padding-top:10px;border-top:1px solid #e2e8f0;font-weight:600;font-size:14px;flex-shrink:0}.star-player-section{flex-shrink:0;margin-top:20px;padding-top:20px;border-top:2px solid #f0f0f0;opacity:0;transform:translateY(20px);transition:opacity .5s .2s ease,transform .5s .2s ease}.star-player-section.visible{opacity:1;transform:translateY(0)}.star-player-title{text-align:center;font-size:18px;font-weight:700;color:#4a5568;text-transform:uppercase;margin-bottom:15px}.star-player-content{display:flex;align-items:center;justify-content:center;gap:30px}.star-player-photo{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid #fff;box-shadow:0 4px 15px rgba(0,0,0,.15)}.star-player-details{display:flex;flex-direction:column;align-items:center;gap:5px}.star-player-name{font-size:28px;font-weight:800}.star-player-rating{font-size:20px;padding:5px 15px;border-radius:16px}.star-player-stats{display:flex;gap:25px;border-left:2px solid #e2e8f0;padding-left:30px;margin-left:10px}.star-player-stats .stat-item{display:flex;flex-direction:column;align-items:center;min-width:80px}.star-player-stats .stat-item span:first-child{font-size:24px;font-weight:700}.star-player-stats .stat-item span:last-child{font-size:12px;color:#718096;text-transform:uppercase}
    </style>
</head>
<body>
    <div id="player-stats-container"></div>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCFDYDSsOswmf2xn8-Z6LNw4Qu-kiph2X4",
            authDomain: "scoreboard-control.firebaseapp.com",
            projectId: "scoreboard-control",
            storageBucket: "scoreboard-control.appspot.com",
            messagingSenderId: "438021450087",
            appId: "1:438021450087:web:cb4eb72e0858b4b2f627c2"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // All of your existing JavaScript for this page remains unchanged
            const container=document.getElementById("player-stats-container"),visibilityDocRef=db.collection("podcast").doc("visibility"),playerStatsDataDocRef=db.collection("podcast").doc("playerStatsData"),fixtureDocRef=db.collection("podcast").doc("currentFixture");let showStats=!1,currentFixtureDetail=null,currentStatsData=null;function renderGraphic(){showStats&&currentFixtureDetail&&currentStatsData?buildGraphic(currentFixtureDetail,currentStatsData):container.innerHTML=""}function getRatingColorClass(t){const a=parseFloat(t);return isNaN(a)?"rating-neutral":a<6?"rating-red":a<7?"rating-neutral":a<8?"rating-green-light":a<9?"rating-green-dark":"rating-blue"}function calculateAverageRating(t){const a=t.filter(t=>t.statistics[0].games.rating&&parseFloat(t.statistics[0].games.rating)>0);if(0===a.length)return"N/A";const e=a.reduce((t,a)=>t+parseFloat(a.statistics[0].games.rating),0);return(e/a.length).toFixed(1)}function findStarPlayer(t,a){const e=[...t,...a].filter(t=>t.statistics[0].games.rating&&parseFloat(t.statistics[0].games.rating)>0);return 0===e.length?null:e.reduce((t,a)=>parseFloat(a.statistics[0].games.rating)>parseFloat(t.statistics[0].games.rating)?a:t)}function buildGraphic(t,a){if(container.innerHTML="",!a||a.length<2||!t)return void(container.innerHTML="<h1>Waiting for complete data...</h1>");const e=a.find(a=>a.team.id===t.teams.home.id)||a[0],s=a.find(a=>a.team.id===t.teams.away.id)||a[1],i=calculateAverageRating(e.players),n=calculateAverageRating(s.players),o=findStarPlayer(e.players,s.players),l=document.createElement("div");l.className="stats-wrapper",l.innerHTML=`
                    <div class="background-logos">
                        <img src="${t.teams.home.logo}" alt="${t.teams.home.name} Logo">
                        <img src="${t.teams.away.logo}" alt="${t.teams.away.name} Logo">
                    </div>
                `;const r=document.createElement("div");r.className="stats-content";const d=new Date(t.fixture.date),c=d.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});r.innerHTML=`
                    <div class="top-bar">
                         <img src="${t.league.logo}" alt="${t.league.name}" class="league-logo">
                        <div class="fixture-details">
                            <div class="fixture-name">
                                <span class="team-name home">${t.teams.home.name}</span>
                                <span class="scoreline">${t.goals.home} - ${t.goals.away}</span>
                                <span class="team-name away">${t.teams.away.name}</span>
                            </div>
                            <div class="fixture-meta">${c} | ${t.fixture.venue.name}</div>
                        </div>
                    </div>
                `;const g=document.createElement("div");g.className="tables-area",g.innerHTML=`
                    <div class="team-table-container">
                        <div class="team-header">
                            <img src="${e.team.logo}" alt="${e.team.name} Logo">
                            <h3>${e.team.name}</h3>
                        </div>
                        <table class="player-table">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th class="text-center">#</th>
                                    <th class="text-center">Mins</th>
                                    <th class="text-center">Rating</th>
                                    <th class="text-center">Gls</th>
                                    <th class="text-center">Ast</th>
                                    <th class="text-center">Shots (On)</th>
                                    <th class="text-center">KeyP</th>
                                    <th class="text-center">Tkls</th>
                                    <th class="text-center">Cards</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generatePlayerRows(e.players)}
                            </tbody>
                        </table>
                        <div class="team-average-rating">
                            <span>Average Rating</span>
                            <span class="rating-cell ${getRatingColorClass(i)}">${i}</span>
                        </div>
                    </div>
                    <div class="team-table-container">
                        <div class="team-header">
                            <img src="${s.team.logo}" alt="${s.team.name} Logo">
                            <h3>${s.team.name}</h3>
                        </div>
                        <table class="player-table">
                           <thead>
                                <tr>
                                    <th>Player</th>
                                    <th class="text-center">#</th>
                                    <th class="text-center">Mins</th>
                                    <th class="text-center">Rating</th>
                                    <th class="text-center">Gls</th>
                                    <th class="text-center">Ast</th>
                                    <th class="text-center">Shots (On)</th>
                                    <th class="text-center">KeyP</th>
                                    <th class="text-center">Tkls</th>
                                    <th class="text-center">Cards</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generatePlayerRows(s.players)}
                            </tbody>
                        </table>
                        <div class="team-average-rating">
                            <span>Average Rating</span>
                            <span class="rating-cell ${getRatingColorClass(n)}">${n}</span>
                        </div>
                    </div>
                `,r.appendChild(g);if(o){const t=o.statistics[0],a=parseFloat(t.games.rating).toFixed(1),e=`images/players/${o.player.id}.png`,s=document.createElement("div");s.className="star-player-section",s.innerHTML=`
                        <div class="star-player-title">⭐ Star Player</div>
                        <div class="star-player-content">
                            <img src="${e}" class="star-player-photo" onerror="this.onerror=null;this.src='${o.player.photo}';">
                            <div class="star-player-details">
                                <div class="star-player-name">${o.player.name}</div>
                                <div class="star-player-rating rating-cell ${getRatingColorClass(a)}">${a}</div>
                            </div>
                            <div class="star-player-stats">
                                <div class="stat-item"><span>${t.goals.total||0}</span><span>Goals</span></div>
                                <div class="stat-item"><span>${t.goals.assists||0}</span><span>Assists</span></div>
                                <div class="stat-item"><span>${t.shots.total||0}</span><span>Shots</span></div>
                                <div class="stat-item"><span>${t.passes.key||0}</span><span>Key Passes</span></div>
                            </div>
                        </div>
                    `,r.appendChild(s)}l.appendChild(r),container.appendChild(l),setTimeout(()=>{l.classList.add("visible"),g.classList.add("visible");const t=container.querySelector(".star-player-section");t&&t.classList.add("visible")},100)}function generatePlayerRows(t){let a="";return t.filter(t=>t.statistics[0].games.minutes).sort((t,a)=>a.statistics[0].games.minutes-t.statistics[0].games.minutes).slice(0,16).forEach(t=>{const e=t.statistics[0],s=e.games.rating?parseFloat(e.games.rating).toFixed(1):"-",i=getRatingColorClass(s);let n="-";e.cards.yellow>0&&(n='<span class="card-yellow"></span>'),e.cards.red>0&&(n="-"!==n?`${n} <span class="card-red"></span>`:'<span class="card-red"></span>'),a+=`
                            <tr>
                                <td>${t.player.name}</td>
                                <td class="text-center">${e.games.number||"-"}</td>
                                <td class="text-center">${e.games.minutes||"-"}</td>
                                <td class="text-center"><span class="rating-cell ${i}">${s}</span></td>
                                <td class="text-center">${e.goals.total||0}</td>
                                <td class="text-center">${e.goals.assists||0}</td>
                                <td class="text-center">${e.shots.total||0} (${e.shots.on||0})</td>
                                <td class="text-center">${e.passes.key||0}</td>
                                <td class="text-center">${e.tackles.total||0}</td>
                                <td class="text-center">${n}</td>
                            </tr>
                        `}),a}visibilityDocRef.onSnapshot(t=>{showStats=t.exists&&t.data().showPlayerStats,renderGraphic()}),fixtureDocRef.onSnapshot(t=>{t.exists&&(currentFixtureDetail=t.data(),renderGraphic())}),playerStatsDataDocRef.onSnapshot(t=>{t.exists&&(currentStatsData=t.data().stats,renderGraphic())});
        });
    </script>
</body>
</html>